import React, { useState, useRef, useEffect } from 'react';
import { Link, router } from '@inertiajs/react';

const Header = ({ user, darkMode, toggleDarkMode }) => {
    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
    const [isSticky, setIsSticky] = useState(false);
    const [activeDropdown, setActiveDropdown] = useState(null);
    const headerRef = useRef(null);

    useEffect(() => {
        const handleScroll = () => {
            const headerHeight = headerRef.current?.offsetHeight || 0;
            setIsSticky(window.scrollY > headerHeight);
        };

        const handleClickOutside = (event) => {
            if (!event.target.closest('.dropdown')) {
                setActiveDropdown(null);
            }
        };

        window.addEventListener('scroll', handleScroll);
        document.addEventListener('click', handleClickOutside);

        return () => {
            window.removeEventListener('scroll', handleScroll);
            document.removeEventListener('click', handleClickOutside);
        };
    }, []);

    const toggleDropdown = (dropdownName) => {
        setActiveDropdown(activeDropdown === dropdownName ? null : dropdownName);
    };

    const handleLogout = () => {
        router.post('/logout');
    };

    const navigationItems = [
        {
            name: 'Home',
            href: '/',
            active: route().current() === 'home'
        },
        {
            name: 'About',
            href: '/about',
            active: route().current() === 'about'
        },
        {
            name: 'Jobs',
            dropdown: 'jobs',
            items: [
                { name: 'Find Jobs', href: '/jobs' },
                { name: 'Job List', href: '/jobs/list' },
                { name: 'Job Grid', href: '/jobs/grid' },
                ...(user ? [{ name: 'Post a Job', href: '/jobs/create' }] : [])
            ]
        },
        {
            name: 'Companies',
            href: '/companies',
            active: route().current()?.startsWith('companies')
        },
        {
            name: 'Candidates',
            href: '/candidates',
            active: route().current()?.startsWith('candidates')
        },
        {
            name: 'Blog',
            href: '/blog',
            active: route().current()?.startsWith('blog')
        },
        {
            name: 'Contact',
            href: '/contact',
            active: route().current() === 'contact'
        }
    ];

    return (
        <div className={`navbar-area ${isSticky ? 'sticky-nav' : ''}`} ref={headerRef}>
            {/* Mobile Navigation */}
            <div className="mobile-nav lg:hidden">
                <div className="container mx-auto px-4">
                    <div className="flex items-center justify-between h-16">
                        <Link href="/" className="logo">
                            <img
                                src="/assets/img/logo.png"
                                alt="Kazi Sasa"
                                className="h-8 w-auto"
                            />
                        </Link>

                        <button
                            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                            className="mobile-menu-btn p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                            aria-label="Toggle mobile menu"
                        >
                            <div className={`hamburger ${mobileMenuOpen ? 'active' : ''}`}>
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </button>
                    </div>
                </div>

                {/* Mobile Menu Overlay */}
                <div className={`mobile-menu-overlay ${mobileMenuOpen ? 'active' : ''}`}>
                    <div className="mobile-menu-content">
                        <div className="mobile-menu-header">
                            <Link href="/" className="logo">
                                <img
                                    src="/assets/img/logo.png"
                                    alt="Kazi Sasa"
                                    className="h-8 w-auto"
                                />
                            </Link>
                            <button
                                onClick={() => setMobileMenuOpen(false)}
                                className="close-mobile-menu"
                            >
                                <i className="bx bx-x text-2xl"></i>
                            </button>
                        </div>

                        <nav className="mobile-nav-menu">
                            {navigationItems.map((item, index) => (
                                <div key={index} className="mobile-nav-item">
                                    {item.dropdown ? (
                                        <>
                                            <button
                                                onClick={() => toggleDropdown(`mobile-${item.dropdown}`)}
                                                className="mobile-nav-link dropdown-toggle"
                                            >
                                                {item.name}
                                                <i className={`bx bx-chevron-down transition-transform ${
                                                    activeDropdown === `mobile-${item.dropdown}` ? 'rotate-180' : ''
                                                }`}></i>
                                            </button>
                                            <div className={`mobile-dropdown ${
                                                activeDropdown === `mobile-${item.dropdown}` ? 'active' : ''
                                            }`}>
                                                {item.items.map((subItem, subIndex) => (
                                                    <Link
                                                        key={subIndex}
                                                        href={subItem.href}
                                                        className="mobile-dropdown-link"
                                                        onClick={() => setMobileMenuOpen(false)}
                                                    >
                                                        {subItem.name}
                                                    </Link>
                                                ))}
                                            </div>
                                        </>
                                    ) : (
                                        <Link
                                            href={item.href}
                                            className={`mobile-nav-link ${item.active ? 'active' : ''}`}
                                            onClick={() => setMobileMenuOpen(false)}
                                        >
                                            {item.name}
                                        </Link>
                                    )}
                                </div>
                            ))}

                            {/* Mobile Auth Links */}
                            <div className="mobile-auth-section">
                                {user ? (
                                    <>
                                        <Link
                                            href="/account"
                                            className="mobile-nav-link"
                                            onClick={() => setMobileMenuOpen(false)}
                                        >
                                            <i className="bx bx-user mr-2"></i>
                                            Account
                                        </Link>
                                        <button
                                            onClick={() => {
                                                handleLogout();
                                                setMobileMenuOpen(false);
                                            }}
                                            className="mobile-nav-link text-red-600"
                                        >
                                            <i className="bx bx-log-out mr-2"></i>
                                            Logout
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <Link
                                            href="/login"
                                            className="mobile-nav-link"
                                            onClick={() => setMobileMenuOpen(false)}
                                        >
                                            <i className="bx bx-log-in mr-2"></i>
                                            Login
                                        </Link>
                                        <Link
                                            href="/register"
                                            className="mobile-nav-link text-blue-600"
                                            onClick={() => setMobileMenuOpen(false)}
                                        >
                                            <i className="bx bx-user-plus mr-2"></i>
                                            Register
                                        </Link>
                                    </>
                                )}
                            </div>
                        </nav>
                    </div>
                </div>
            </div>

            {/* Desktop Navigation */}
            <div className="main-nav hidden lg:block">
                <div className="container mx-auto px-4">
                    <nav className="flex items-center justify-between h-20">
                        {/* Logo */}
                        <Link href="/" className="logo">
                            <img
                                src="/assets/img/logo.png"
                                alt="Kazi Sasa"
                                className="h-10 w-auto"
                            />
                        </Link>

                        {/* Main Navigation */}
                        <div className="main-navigation">
                            <ul className="navbar-nav">
                                {navigationItems.map((item, index) => (
                                    <li key={index} className={`nav-item ${item.dropdown ? 'dropdown' : ''}`}>
                                        {item.dropdown ? (
                                            <>
                                                <button
                                                    onClick={() => toggleDropdown(item.dropdown)}
                                                    className={`nav-link dropdown-toggle ${
                                                        item.items?.some(subItem =>
                                                            window.location.pathname === subItem.href
                                                        ) ? 'active' : ''
                                                    }`}
                                                >
                                                    {item.name}
                                                    <i className="bx bx-chevron-down ml-1"></i>
                                                </button>
                                                <ul className={`dropdown-menu ${
                                                    activeDropdown === item.dropdown ? 'show' : ''
                                                }`}>
                                                    {item.items.map((subItem, subIndex) => (
                                                        <li key={subIndex} className="nav-item">
                                                            <Link
                                                                href={subItem.href}
                                                                className={`nav-link ${
                                                                    window.location.pathname === subItem.href ? 'active' : ''
                                                                }`}
                                                                onClick={() => setActiveDropdown(null)}
                                                            >
                                                                {subItem.name}
                                                            </Link>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </>
                                        ) : (
                                            <Link
                                                href={item.href}
                                                className={`nav-link ${item.active ? 'active' : ''}`}
                                            >
                                                {item.name}
                                            </Link>
                                        )}
                                    </li>
                                ))}
                            </ul>
                        </div>

                        {/* Auth Section */}
                        <div className="auth-section flex items-center gap-4">
                            {user ? (
                                <div className="user-menu dropdown">
                                    <button
                                        onClick={() => toggleDropdown('user-menu')}
                                        className="user-menu-trigger flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                    >
                                        <div className="user-avatar">
                                            {user.profile_image ? (
                                                <img
                                                    src={user.profile_image}
                                                    alt={user.first_name}
                                                    className="w-8 h-8 rounded-full object-cover"
                                                />
                                            ) : (
                                                <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                                    {user.first_name?.[0]}{user.last_name?.[0]}
                                                </div>
                                            )}
                                        </div>
                                        <span className="user-name text-sm font-medium text-gray-700 dark:text-gray-300">
                                            {user.first_name} {user.last_name}
                                        </span>
                                        <i className="bx bx-chevron-down text-gray-500"></i>
                                    </button>

                                    <div className={`user-dropdown dropdown-menu ${
                                        activeDropdown === 'user-menu' ? 'show' : ''
                                    }`}>
                                        <div className="user-info">
                                            <div className="user-name">{user.first_name} {user.last_name}</div>
                                            <div className="user-email">{user.email}</div>
                                        </div>
                                        <div className="dropdown-divider"></div>
                                        <Link href="/account" className="dropdown-item">
                                            <i className="bx bx-user mr-2"></i>
                                            My Account
                                        </Link>
                                        <Link href="/account/profile" className="dropdown-item">
                                            <i className="bx bx-edit mr-2"></i>
                                            Edit Profile
                                        </Link>
                                        <Link href="/account/applied-jobs" className="dropdown-item">
                                            <i className="bx bx-briefcase mr-2"></i>
                                            Applied Jobs
                                        </Link>
                                        <Link href="/account/saved-jobs" className="dropdown-item">
                                            <i className="bx bx-heart mr-2"></i>
                                            Saved Jobs
                                        </Link>
                                        <div className="dropdown-divider"></div>
                                        <button
                                            onClick={handleLogout}
                                            className="dropdown-item text-red-600 hover:bg-red-50 w-full text-left"
                                        >
                                            <i className="bx bx-log-out mr-2"></i>
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="auth-buttons flex items-center gap-3">
                                    <Link
                                        href="/login"
                                        className="btn btn-outline-primary"
                                    >
                                        <i className="bx bx-log-in mr-2"></i>
                                        Login
                                    </Link>
                                    <Link
                                        href="/register"
                                        className="btn btn-primary"
                                    >
                                        <i className="bx bx-user-plus mr-2"></i>
                                        Register
                                    </Link>
                                </div>
                            )}
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    );
};

export default Header;

